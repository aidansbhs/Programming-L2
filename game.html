<!doctype html>

<head>
    <title>Big Head Soccer</title>
</head>

<body>
    <style>
        canvas {
            padding-left: 0;
            padding-right: 0;
            margin-left: auto;
            margin-right: auto;
            margin-top: 15vh;
            display: block;
        }

    </style>

    <canvas id="gameCanvas" width="800" height="575"></canvas>
    <script>
        var canvas, ctx;

        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');

            imageAssets = loadImages();

            setInterval(mainloop, 1000 / 50);

            document.addEventListener('keydown', keyPressed);
            document.addEventListener('keyup', keyReleased);

            makeBall();

            document.addEventListener('mousemove', function(evt) { //mouse code
                var mousePos = mouseAction(evt);
                mouseX = mousePos.x;
                mouseY = mousePos.y;
            });
        }

        //player 1
        player = {
            playerXpos: 0,
            playerYpos: 0,
            PLAYER_SIZE: 40,
            playerXspeed: 3.5,
            playerYspeed: 5,
        }

        // player 2
        player2 = {
            player2Xpos: 0,
            player2Ypos: 0,
            PLAYER2_SIZE: 40,
            player2Xspeed: 3.5,
            player2Yspeed: 5,
        }

        bot = {
            botXpos: 0,
            botYpos: 0,
            BOT_SIZE: 40,
            botXspeed: 3.5,
            botYspeed: 5,
        }

        //physics
        var gravity = 0.1;
        var gravity2 = 0.1;
        var bounce = 0.6;
        var friction = 0.1;
        var jumpForce = -30;
        var jumping = false;
        var jumping2 = false;
        var kickspeed = 4.5;
        var normalSpeed = 3.5;
        var stacking = false;
        var stacking2 = false;
        var pushingRight = false;
        var pushingLeft = false
        var pushing2Left = false;
        var pushing2Right = false;
        var stopped = false
        var p1LW = false;
        var p1RW = false;
        var p2LW = false;
        var p2RW = false;
        var temp1 = false;
        var temp2 = false;
        var minBallXspeed = 1.5;

        //ground variables
        var groundYpos = 0;
        var groundXpos = 0;
        var groundWidth = 0;
        var groundLength = 0;

        //controls for players

        //player 1
        const A_KEY = 65;
        const D_KEY = 68;
        const W_KEY = 87;
        const S_KEY = 83;
        var aKeyPressed = false;
        var dKeyPressed = false;
        var wKeyPressed = false;
        var sKeyPressed = false;

        //player 2
        const LEFT_KEY = 37;
        const RIGHT_KEY = 39;
        const UP_KEY = 38;
        const DOWN_KEY = 40;
        var leftKeyPressed = false;
        var rightKeyPressed = false;
        var upKeyPressed = false;
        var downKeyPressed = false;

        //game variables
        var mouseX, mouseY;
        var mouseDown = 0;
        var startingPos = true;
        var startingPos2 = true;
        var startingPos3 = true;
        var gameStart = false;
        var singlePlayer = false;
        var twoPlayer = false;
        var gameFinished = false;
        var startGame = false;
        var startOfGame = true;
        var count = -1;
        var score1 = 0;
        var score2 = 0;
        var leftGoalScored = false;
        var rightGoalScored = false;
        var goalScored = false;
        var goalScored2 = false;
        var startRestartCount = false;
        var reset = false;
        var resetCount = 50;
        var endGameCount = 110;
        var balls = [];
        var runOnce = true;
        
        //difficulty and game type
        var gamemodes = ['First to Seven', 'Golden Goal'];
        var gamemodesCount = 0;
        var gameVariants = ['Regular', 'Two Balls'];
        var gameVariantsCount = 0;
        var gameDifficulty = ['Easy', 'Hard'];
        var difficultyCount = 0;
        var buttonTest = false;

        // menu buttons
        var mainMenu = true;
        var singlePlayerSelect = false;
        var twoPlayerSelect = false;
        var instructionsSelect = false;
        var backButtonClicked = false;

        //prompts 
        var maxLength = 15;
        var name = prompt("What is your name?", 'Naruto') //prompt asks for user name
        while (name.length < 2 || name.length > maxLength || name == 'null') {
            alert("Please type a valid name"); //if the user types a name that is less than 2 characters or doesn't type anything it will reprompt them 
            name = prompt("What's your name?");
        }

        function mainloop() {
            if (mainMenu == false) {
                if (gameFinished == false) {

                    if (gameStart == true) {

                        drawImage(imageAssets.background, 0, 0, canvas.width, canvas.height); //bg

                        if (singlePlayer == true) { //run single player
                            gameSetup();
                            singlePlayerRun();
                            return twoPlayerRun;
                        }
                        if (twoPlayer == true) { // run two player
                            gameSetup();
                            twoPlayerRun();
                            singlePlayerRun(); // has to be correct order in order for collisons to work
                        }
                    }
                }
            } else {
                drawImage(imageAssets.menuScreen, 0, 0, canvas.width, canvas.height); //draws the menu screen
                menuButtons(); //allows for menu buttons to be interacted with

                if (singlePlayerSelect == true) { //display screen for single play select if it is true inside the menu buttons function
                    singlePlayerSelection();
                    startButton();

                } else if (twoPlayerSelect == true) { //display screen for two player select if it is true inside the menuButtons function
                    twoPlayerSelection();
                    startButton();

                } else if (instructionsSelect == true) {
                    instructionSelection();
                }
            }
        } //end of mainloop

        function gameSetup() {
            groundLength = canvas.width;
            groundYpos = canvas.height - 79;

            drawGround();
            startGameTimer();
            balls.forEach(Element => {
                drawBall(Element.x, Element.y, Element.radius, 'white'); 
            });

            if (count <= 10) {
                ballCollisions();
                ballMove();
                scoring();
                gameEnd();
            }
        } //end gameSetup

        function singlePlayerRun() { //all functions requried for single player
            if (startingPos == true) { //starting position
                startPos1();
                startingPos = false;
                count = 160;
            }
            if (singlePlayer == true && twoPlayer == false) { //only starts up if singleplayer is selected therefore bot will not be in other gamemodes
                if (startingPos3 == true) {
                    startPos3();
                    startingPos3 = false;
                }
                drawBot();
                if (count <= 10) {
                    botMove();
                }
            }
            drawPlayer();

            if (count <= 10) { //so players can't move before countdown
                playerGravity();
                playerMove();
                playerJump();
            }
        } //end of singlePlayerRun

        function twoPlayerRun() { // all functions required for two player 
            if (startingPos2 == true) {
                startPos2();
                startingPos2 = false;
                count = 160;
            }
            drawPlayer2();

            if (count <= 10) {
                player2Gravity();
                player2Move();
                player2Jump();
                playerCollisions();
            }
        } //end of twoPlayerRun

        function menuButtons() {
            //button coordinates
            let buttonXposLeft = canvas.width / 2.82;
            let buttonXposRight = canvas.width / 1.574;
            let buttonYposTop = canvas.height / 2.78;
            let buttonYposBot = canvas.height / 2.262;
            let button2YposTop = canvas.height / 2.035;
            let button2YposBot = canvas.height / 1.742;
            let button3YposTop = canvas.height / 1.603;
            let button3YposBot = canvas.height / 1.415;

            if (mouseX >= buttonXposLeft && mouseX <= buttonXposRight && mouseY >= buttonYposTop && mouseY <= buttonYposBot) { // button 1 coordinates
                colorRect(buttonXposLeft, buttonYposTop, (buttonXposRight - buttonXposLeft), (buttonYposBot - buttonYposTop), 'rgb(0,0,0,0.2)'); //hover
                if (mouseDown && twoPlayerSelect == false && instructionsSelect == false) {
                    singlePlayerSelect = true;
                }
            }
            if (mouseX >= buttonXposLeft && mouseX <= buttonXposRight && mouseY >= button2YposTop && mouseY <= button2YposBot) { // button 2 coordinates
                colorRect(buttonXposLeft, button2YposTop, (buttonXposRight - buttonXposLeft), (button2YposBot - button2YposTop), 'rgb(0,0,0,0.2)'); //hover 
                if (mouseDown && singlePlayerSelect == false && instructionsSelect == false) {
                    twoPlayerSelect = true;
                }
            }
            if (mouseX >= buttonXposLeft && mouseX <= buttonXposRight && mouseY >= button3YposTop && mouseY <= button3YposBot) { // button 3 coordinates
                colorRect(buttonXposLeft, button3YposTop, (buttonXposRight - buttonXposLeft), (button3YposBot - button3YposTop), 'rgb(0,0,0,0.2)'); //hover
                if (mouseDown & singlePlayerSelect == false && twoPlayerSelect == false) {
                    instructionsSelect = true;
                }
            }
        } //end of menuButtons

        function singlePlayerSelection() {

            let difficultyLeft = canvas.width / 4.54;
            let difficultyRight = canvas.width / 4.11;
            let difficultyTop = canvas.height / 1.771;
            let difficultyBot = canvas.height / 1.67;

            let gameplayLeft = canvas.width / 1.735;
            let gameplayRight = canvas.width / 1.668;
            let gameplayTop = canvas.height / 1.771;
            let gameplayBot = canvas.height / 1.67;

            drawImage(imageAssets.singlePlayerSelection, 0, 0, canvas.width, canvas.height);
            backButton();

            drawText(canvas.width / 2.15, canvas.height / 2.59, name, "14px Arial", "rgb(255,255,255,1)", "center");

            if (mouseX >= difficultyLeft && mouseX <= difficultyRight && mouseY >= difficultyTop && mouseY <= difficultyBot) {
                colorRect(difficultyLeft, difficultyTop, (difficultyRight - difficultyLeft), (difficultyBot - difficultyTop), 'rgb(255,255,255,0.2)');
                if (mouseDown) {
                    if (buttonTest == false) { //fixes holding down mouse
                        buttonTest = true;
                        difficultyCount++;
                        if (difficultyCount >= gameDifficulty.length) { 
                            difficultyCount = 0;
                        }
                    }
                } else {
                    buttonTest = false;
                }
            }

            drawText(canvas.width / 3.54, canvas.height / 1.69, gameDifficulty[difficultyCount], "16px Arial", "rgb(0,0,0,1)", "center");

            if (mouseX >= gameplayLeft && mouseX <= gameplayRight && mouseY >= gameplayTop && mouseY <= gameplayBot) {
                colorRect(gameplayLeft, gameplayTop, (gameplayRight - gameplayLeft), (gameplayBot - gameplayTop), 'rgb(255,255,255,0.2)');
                if (mouseDown) {
                    if (buttonTest == false) {
                        buttonTest = true;
                        gamemodesCount++;
                        if (gamemodesCount >= gamemodes.length) {
                            gamemodesCount = 0;
                        }
                    }
                } else {
                    buttonTest = false;
                }
            }

            drawText(canvas.width / 1.49, canvas.height / 1.69, gamemodes[gamemodesCount], "16px Arial", "rgb(0,0,0,1)", "center");

        } //end of singlePlayerSelection

        function twoPlayerSelection() { // when twoPlayerSelect equals true run this

            let squareLeft = canvas.width / 2.54;
            let squareRight = canvas.width / 2.395;
            let squareTop = canvas.height / 2.14;
            let sqaureBot = canvas.height / 2;
            let square2Top = canvas.height / 1.935;
            let square2Bot = canvas.height / 1.815;

            drawImage(imageAssets.twoPlayerSelection, 0, 0, canvas.width, canvas.height);
            backButton();

            if (mouseX >= squareLeft && mouseX <= squareRight && mouseY >= squareTop && mouseY <= sqaureBot) { //sqaure 1
                colorRect(squareLeft, squareTop, (squareRight - squareLeft), (sqaureBot - squareTop), 'rgb(255,255,255,0.2)');
                if (mouseDown) {
                    if (buttonTest == false) {
                        buttonTest = true;
                        gamemodesCount++;
                        if (gamemodesCount >= gamemodes.length) {
                            gamemodesCount = 0;
                        }
                    }
                } else {
                    buttonTest = false;
                }
            }

            drawText(canvas.width / 2.05, canvas.height / 2.035, gamemodes[gamemodesCount], "16px Arial", "rgb(0,0,0,1)", "center");

            if (mouseX >= squareLeft && mouseX <= squareRight && mouseY >= square2Top && mouseY <= square2Bot) { //sqaure 2
                colorRect(squareLeft, square2Top, (squareRight - squareLeft), (square2Bot - square2Top), 'rgb(255,255,255,0.2)');
                if (mouseDown) {
                    if (buttonTest == false) {
                        buttonTest = true;
                        gameVariantsCount++;
                        if (gameVariantsCount >= gameVariants.length) {
                            gameVariantsCount = 0;
                        }
                    }
                } else {
                    buttonTest = false;
                }
            }

            drawText(canvas.width / 2.14, canvas.height / 1.84, gameVariants[gameVariantsCount], "16px Arial", "rgb(0,0,0,1)", "center");
        } //end of twoPlayerSelection

        function instructionSelection() {
            drawImage(imageAssets.instructionsSelection, 0, 0, canvas.width, canvas.height);
            backButton();
        } //end of instructionSelection

        function backButton() {
            //back button coordinates
            let backButtonLeft = canvas.width / (12 * 6);
            let backButtonRight = canvas.width / 7.2;
            let backButtonTop = canvas.height / (12 * 2.4);
            let backButtonBot = canvas.height / 10.65;

            if (mouseX >= backButtonLeft && mouseX <= backButtonRight && mouseY >= backButtonTop && mouseY <= backButtonBot) {
                colorRect(backButtonLeft, backButtonTop, (backButtonRight - backButtonLeft), (backButtonBot - backButtonTop), 'rgb(0,0,0,0.2)'); //hover
                if (mouseDown) {
                    twoPlayerSelect = false;
                    singlePlayerSelect = false;
                    instructionsSelect = false;
                    mainMenu = true;
                    drawImage(imageAssets.menuScreen, 0, 0, canvas.width, canvas.height);
                }
            }
        } //end of backButton

        function startButton() {
            //start button coordinates
            let startButtonLeft = canvas.width / 2.6;
            let startButtonRight = canvas.width / 1.72;
            let startButtonTop = canvas.height / 1.417;
            let startButtonBot = canvas.height / 1.291;

            if (mouseX >= startButtonLeft && mouseX <= startButtonRight && mouseY >= startButtonTop && mouseY <= startButtonBot) {
                colorRect(startButtonLeft, startButtonTop, (startButtonRight - startButtonLeft), (startButtonBot - startButtonTop), 'rgb(0,0,0,0.2)'); //hover
                if (mouseDown) {
                    if (singlePlayerSelect == true) {
                        startSinglePlayer();
                        singlePlayerSelect = false;
                    }
                    if (twoPlayerSelect == true) {
                        startTwoPlayer();
                        twoPlayerSelect = false;
                    }
                }
            }
        } //end of startButton

        function startTwoPlayer() {
            mainMenu = false;
            gameFinished = false;
            gameStart = true;
            twoPlayer = true;
            twoPlayerSelect = false;
        } //end of startTwoplayer

        function startSinglePlayer() {
            mainMenu = false;
            gameFinished = false;
            gameStart = true;
            singlePlayer = true;
            singlePlayerSelect = false;
        } //end of startSinglePlayer

        function startPos1() { //starting position for player 1 
            player.playerXpos = canvas.width / 6 - player.PLAYER_SIZE / 2;
            player.playerYpos = canvas.height / 1.21 - player.PLAYER_SIZE / 2;
        } //end of startPos1

        function startPos2() { //starting position for player 2
            player2.player2Xpos = canvas.width / 1.2 - player2.PLAYER2_SIZE / 2;
            player2.player2Ypos = canvas.height / 1.21 - player2.PLAYER2_SIZE / 2;
        } //end of startPos2

        function startPos3() {
            if (singlePlayer == true && twoPlayer == false) {
                bot.botXpos = canvas.width / 1.2 - bot.BOT_SIZE / 2;
                bot.botYpos = canvas.height / 1.21 - bot.BOT_SIZE / 2;
            }
        } //end of startPos3

        function loadImages() { //all of the images required in the game are stored here for conveince
            imgs = [];
            imgs.background = new Image();
            imgs.background.src = 'img/tempBack.png';
            imgs.menuScreen = new Image();
            imgs.menuScreen.src = 'img/menuScreen.png';
            imgs.singlePlayerSelection = new Image();
            imgs.singlePlayerSelection.src = 'img/singlePlayerMenu.png';
            imgs.twoPlayerSelection = new Image();
            imgs.twoPlayerSelection.src = 'img/twoPlayerMenu.png';
            imgs.instructionsSelection = new Image();
            imgs.instructionsSelection.src = 'img/instructionMenu.png';
            imgs.player1 = new Image();
            imgs.player1.src = 'img/player1.png';
            imgs.player2 = new Image();
            imgs.player2.src = 'img/player2.png';
            imgs.bot = new Image();
            imgs.bot.src = 'img/bot.png';
            return imgs;
        } // end of loadImages

        function makeBall() { //properties of ball
            balls.push({
                x: canvas.width / 2,
                y: canvas.height / 2,
                radius: 13,
                status: 0,
                ballXspeed: Math.floor(Math.random() * (3 - -1.5)) - 1.5,
                ballYspeed: 0,
                ballGravity: 0.15,
                ballRandomTest1: false,
                ballRandomTest2: false
            });
        } //end of makeBall

        function ballMove() {
            balls.forEach(Element => {
                Element.x += Element.ballXspeed; //x speed
                Element.y += Element.ballYspeed; //y speed
                Element.ballYspeed += Element.ballGravity; //apply gravity to ball y speed
                if (Element.y + Element.radius > groundYpos) { //if the ball is greater than the ground floor
                    Element.y = groundYpos - Element.radius; //reposition on the ground
                    Element.ballYspeed *= -bounce; //bounce the ball

                    if (Element.ballYspeed < 0 && Element.ballYspeed > -2.2) { //do this otherwise, ball never stops bouncing
                        Element.ballYspeed = 0;
                    }

                    if (Math.abs(Element.ballXspeed) > minBallXspeed) { //apply friction if ball speed is bigger than this
                        if (Element.ballXspeed > 0) {
                            Element.ballXspeed = Element.ballXspeed - friction;
                        } else if (Element.ballXspeed < 0) {
                            Element.ballXspeed = Element.ballXspeed + friction;
                        }
                    } else if (Math.abs(Element.ballXspeed) > minBallXspeed / 2) { //stages of friction
                        if (Element.ballXspeed > 0) {
                            Element.ballXspeed = Element.ballXspeed - friction / 4;
                        } else if (Element.ballXspeed < 0) {
                            Element.ballXspeed = Element.ballXspeed + friction / 4;
                        }
                    } else if (Math.abs(Element.ballXspeed) > minBallXspeed / 4) { //gets less as ball speed decreases
                        if (Element.ballXspeed > 0) {
                            Element.ballXspeed = Element.ballXspeed - friction / 8;
                        } else if (Element.ballXspeed < 0) {
                            Element.ballXspeed = Element.ballXspeed + friction / 8;
                        }
                    } else if (Math.abs(Element.ballXspeed) > minBallXspeed / 8) {
                        if (Element.ballXspeed > 0) {
                            Element.ballXspeed = Element.ballXspeed - friction / 16;
                        } else if (Element.ballXspeed < 0) {
                            Element.ballXspeed = Element.ballXspeed + friction / 16;
                        }
                    }
                }
                if (Element.x > canvas.width - Element.radius && Element.ballXspeed > 0) { //right edge bounce
                    Element.ballXspeed *= -1;
                }
                if (Element.x < 0 + Element.radius && Element.ballXspeed < 0) { //left edge bounce
                    Element.ballXspeed *= -1;
                }
                if (gameVariantsCount == 1 && runOnce == true) { //pushes a new ball if two balls gamevariant is selected
                    balls.push({ //ball 2
                        x: canvas.width / 2,
                        y: canvas.height / 2.3,
                        radius: 13,
                        status: 0,
                        ballXspeed: Math.floor(Math.random() * (3 - -1.5)) - 1.5,
                        ballYspeed: 0,
                        ballGravity: 0.15,
                        ballRandomTest1: false,
                        ballRandomTest2: false
                    });
                    runOnce = false;
                }
            });
        } //end of ballMove

        function ballCollisions() {
            balls.forEach(Element => {
                if (Element.x - Element.radius <= player.playerXpos + player.PLAYER_SIZE && Element.x + Element.radius >= player.playerXpos && Element.y <= player.playerYpos + player.PLAYER_SIZE && Element.y + Element.radius >= player.playerYpos) { //player1 hitbox with ball

                    if (dKeyPressed == false && aKeyPressed == false && Element.ballRandomTest1 == false) {
                        if (gravity >= 4) {
                            if (Element.x < player.playerXpos + player.PLAYER_SIZE / 2) {
                                Element.ballXspeed = -kickspeed;
                                Element.ballRandomTest1 = true;
                            }
                            if (Element.x >= player.playerXpos + player.PLAYER_SIZE / 2) {
                                Element.ballXspeed = kickspeed;
                                Element.ballRandomTest1 = true;
                            }
                        } else {
                            if (Element.x < player.playerXpos + player.PLAYER_SIZE / 2 && Element.ballXspeed > 0) {
                                Element.ballXspeed = -Element.ballXspeed + Element.ballXspeed / 4;
                            } else if (Element.x >= player.playerXpos + player.PLAYER_SIZE / 2 && Element.ballXspeed < 0) {
                                Element.ballXspeed = -Element.ballXspeed - Element.ballXspeed / 4;
                            }
                        }
                    } else {
                        if (Element.x < player.playerXpos + player.PLAYER_SIZE / 2) {
                            Element.ballXspeed = -kickspeed; //fix this *********. Wow! watch you language aidan - jono
                        }
                        if (Element.x >= player.playerXpos + player.PLAYER_SIZE / 2) {
                            Element.ballXspeed = kickspeed;
                        } //if ball inside player it will go outwards in the right direction
                    }
                    Element.ballYspeed = gravity / 5 - 2; //how high the ball goes when player hits it in the y direction
                } else {
                    Element.ballRandomTest1 = false;
                } //end of player 1 collisions with ball

                if (Element.x - Element.radius <= player2.player2Xpos + player2.PLAYER2_SIZE && Element.x + Element.radius >= player2.player2Xpos && Element.y <= player2.player2Ypos + player2.PLAYER2_SIZE && Element.y + Element.radius >= player2.player2Ypos && twoPlayer == true) { //player 2 hitbox when it touches ball

                    if (rightKeyPressed == false && leftKeyPressed == false && Element.ballRandomTest2 == false) {
                        if (gravity2 >= 4) {
                            if (Element.x < player2.player2Xpos + player2.PLAYER2_SIZE / 2) {
                                Element.ballXspeed = -kickspeed;
                                Element.ballRandomTest2 = true;
                            }
                            if (Element.x >= player2.player2Xpos + player2.PLAYER2_SIZE / 2) {
                                Element.ballXspeed = kickspeed;
                                Element.ballRandomTest2 = true;
                            }
                        } else {
                            if (Element.x < player2.player2Xpos + player2.PLAYER2_SIZE / 2 && Element.ballXspeed > 0) {
                                Element.ballXspeed = -Element.ballXspeed + Element.ballXspeed / 4;
                            } else if (Element.x >= player2.player2Xpos + player2.PLAYER2_SIZE / 2 && Element.ballXspeed < 0) {
                                Element.ballXspeed = -Element.ballXspeed - Element.ballXspeed / 4;
                            }
                        }
                    } else {
                        if (Element.x < player2.player2Xpos + player2.PLAYER2_SIZE / 2) {
                            Element.ballXspeed = -kickspeed;
                        }
                        if (Element.x >= player2.player2Xpos + player2.PLAYER2_SIZE / 2) {
                            Element.ballXspeed = kickspeed;
                        } //if ball inside player it will go outwards in the right direction
                    }
                    Element.ballYspeed = gravity2 / 5 - 2; //how high the ball goes when player 2 hits it in the y direction
                } else {
                    Element.ballRandomTest2 = false;
                } //end of player 2 collisions with ball

                if (Element.x - Element.radius <= bot.botXpos + bot.BOT_SIZE && Element.x + Element.radius >= bot.botXpos && Element.y <= bot.botYpos + bot.BOT_SIZE && Element.y + Element.radius >= bot.botYpos) { //player 2 hitbox when it touches ball
                    Element.ballXspeed = -kickspeed;
                }
            });
        } //end of ball Collisions

        function playerCollisions() {
            if (player.playerXpos + player.PLAYER_SIZE >= player2.player2Xpos && player.playerXpos < player2.player2Xpos + player2.PLAYER2_SIZE && player.playerYpos + player.PLAYER_SIZE >= player2.player2Ypos) { //player 1 hitbox

                if (aKeyPressed == true && player2.player2Xpos > 0 && player.playerXpos >= player2.player2Xpos) { //player 1 pushing player 2 left
                    pushingLeft = true
                }
                if (dKeyPressed == true && player2.player2Xpos < canvas.width - player2.PLAYER2_SIZE) { //player 1 pushing player 2 right
                    pushingRight = true;
                }

                if (aKeyPressed == true && player2.player2Xpos <= 0) { //player 2 against left wall
                    p2LW = true;
                }
                if (dKeyPressed == true && player2.player2Xpos >= canvas.width - player2.PLAYER2_SIZE) { //player 2 against right wall
                    p2RW = true;
                }

                //player 1 stacking

                if (player.playerYpos + player.PLAYER_SIZE <= player2.player2Ypos + player2.PLAYER2_SIZE * 0.9) {
                    player.playerYpos = player2.player2Ypos - player2.PLAYER2_SIZE;
                    gravity = gravity2;
                    stacking = true;
                    pushingLeft = false;
                    pushingRight = false;
                } else {
                    stacking = false;
                }

                if (pushingLeft == true && pushingRight == false && pushing2Left == false && pushing2Right == false && stacking == false && stacking2 == false) {
                    player2.player2Xpos -= player.playerXspeed / 2;
                    player.playerXpos += player.playerXspeed / 2;
                }

                if (pushingLeft == false && pushingRight == true && pushing2Left == false && pushing2Right == false && stacking == false && stacking2 == false) {
                    player2.player2Xpos += player.playerXspeed / 2;
                    player.playerXpos -= player.playerXspeed / 2;
                }
            } else {
                p2LW = false;
                p2RW = false;
                stacking = false;
                pushingLeft = false;
                pushingRight = false;
            } //end of player1 collisions

            if (player.playerXpos + player.PLAYER_SIZE >= player2.player2Xpos && player.playerXpos < player2.player2Xpos + player2.PLAYER2_SIZE && player2.player2Ypos + player2.PLAYER2_SIZE >= player.playerYpos) { // player 2 hitbox

                if (leftKeyPressed == true && player.playerXpos > 0 && player2.player2Xpos <= player.playerXpos + player.PLAYER_SIZE) { //player 2 pushing player 1 left
                    pushing2Left = true;
                }
                if (rightKeyPressed && player.playerXpos < canvas.width - player.PLAYER_SIZE) { //player 2 pushing player 1 right
                    pushing2Right = true
                }

                if (leftKeyPressed == true && player.playerXpos <= 0) {
                    p1LW = true;
                }
                if (rightKeyPressed == true && player.playerXpos >= canvas.width - player.PLAYER_SIZE) {
                    p1RW = true;
                }

                //player 2 stacking

                if (player2.player2Ypos + player2.PLAYER2_SIZE <= player.playerYpos + player.PLAYER_SIZE * 0.1) { // stacking player 2
                    player2.player2Ypos = player.playerYpos - player.PLAYER_SIZE;
                    gravity2 = gravity; //makes it so players aren't constantly gaining gravity when stacked and therefore fall off
                    stacking2 = true;
                    pushing2Left = false;
                    pushing2Right = false;
                } else {
                    stacking2 = false;
                }

                if (pushingLeft == false && pushingRight == false && pushing2Left == true && pushing2Right == false && stacking == false && stacking2 == false) {
                    player.playerXpos -= player2.player2Xspeed / 2;
                    player2.player2Xpos += player.playerXspeed / 2;
                }

                if (pushingLeft == false && pushingRight == false && pushing2Left == false && pushing2Right == true && stacking == false && stacking2 == false) {
                    player.playerXpos += player2.player2Xspeed / 2;
                    player2.player2Xpos -= player.playerXspeed / 2;
                }
            } else {
                p1LW = false;
                p1RW = false;
                stacking2 = false;
                pushing2Left = false;
                pushing2Right = false;
            } //player 2 collisions

            if (pushingRight == true && pushing2Left == true || pushing2Right == true && pushingLeft == true && stacking == false && stacking2 == false) {
                stopped = true; //both players acting against each other
            } else {
                stopped = false;
            }
            if (stopped == true && player.playerXpos + player.PLAYER_SIZE / 2 >= player2.player2Xpos + player2.PLAYER2_SIZE / 2) {
                temp1 = true;

            } else if (stopped == true && player.playerXpos + player.PLAYER_SIZE / 2 <= player2.player2Xpos + player2.PLAYER2_SIZE / 2) {
                temp2 = true;
            } else {
                temp1 = false;
                temp2 = false;
            }
        } //end of playerCollisions

        function botMove() {
            if (singlePlayer == true && twoPlayer == false) {
                if (player.playerXpos + player.PLAYER_SIZE >= bot.botXpos && player.playerXpos < bot.botXpos + bot.BOT_SIZE && player.playerYpos + player.PLAYER_SIZE >= bot.botYpos) { //hitboxes with bot and player
                    player.playerXpos -= bot.botXspeed;
                    bot.botXpos += player.playerXspeed;
                }
                if (difficultyCount == 0) { //easy
                    let container = [];
                    let count = 0;
                    balls.forEach(Element => {
                        count++;
                        let tempx = JSON.parse(JSON.stringify(Element.x)); //clones objects value to ensure there are no bugs with fundamentals
                        let tempy = JSON.parse(JSON.stringify(Element.y));
                        let tempballYspeed = JSON.parse(JSON.stringify(Element.ballYspeed));
                        let tempballXspeed = JSON.parse(JSON.stringify(Element.ballXspeed));

                        while (tempy <= canvas.height / 6 * 4) {
                            tempy += tempballYspeed;
                            tempballYspeed += Element.ballGravity;
                            tempx += 5;
                        }
                        container.push([tempx, count - 1]);
                    });
                    let container2 = JSON.parse(JSON.stringify(container)); //second ball
                    container.forEach(Element => {
                        Element[0] = Math.abs(Element[0] - bot.botXpos);
                    });
                    if (container.length >= 2) {
                        container.sort(function(a, b) { //sorts if there are two balls
                            return a[0] - b[0]
                        });
                    }
                    if (container2[container[0][1]][0] <= bot.botXpos) { //move after ball
                        bot.botXpos -= bot.botXspeed;
                    } else if (container2[container[0][1]][0] >= bot.botXpos) {
                        bot.botXpos += bot.botXspeed;
                    }
                }

                if (difficultyCount == 1) { //hard
                    balls.forEach(Element => {
                        if (Element.x <= canvas.width / 2) { //ball is in opponents half
                            bot.botXpos += 3.5; //move back towards goal
                            if (bot.botXpos >= canvas.width - 150) { //stay in goal
                                bot.botXpos = canvas.width - 150;
                            }
                        }
                        if (Element.x >= canvas.width / 2) { //if ball in our half
                            bot.botXpos -= 3.5; //move out of goal
                            if (bot.botXpos < 0) { //if past left 
                                bot.botXpos = 0;
                            }
                        }

                        if (Element.x >= bot.botXpos + bot.BOT_SIZE) { //if ball is on right side of player
                            bot.botXpos += 7; // go after ball
                            if (bot.botXpos >= canvas.width - 150) { //stop at goal
                                bot.botXpos = canvas.width - 150;
                            }
                        }
                    });
                }
            }
        } //end of BotMove

        function playerMove() {
            if (dKeyPressed && player.playerXpos < canvas.width - player.PLAYER_SIZE && p2RW == false && temp2 == false || stacking == true && dKeyPressed && player.playerXpos < canvas.width - player.PLAYER_SIZE && temp2 == false) {
                player.playerXpos += player.playerXspeed; // x move right if not outside canvas
            }
            if (aKeyPressed && player.playerXpos > 0 && p2LW == false && temp1 == false) {
                player.playerXpos -= player.playerXspeed; // x move left if not outside canvas
            }
        } //end of playerMove

        function player2Move() {
            if (rightKeyPressed && player2.player2Xpos < canvas.width - player2.PLAYER2_SIZE && p1RW == false && temp1 == false || stacking2 == true && rightKeyPressed && player2.player2Xpos < canvas.width - player2.PLAYER2_SIZE && temp1 == false) {
                player2.player2Xpos += player2.player2Xspeed; // x move right if not outside canvas
            }
            if (leftKeyPressed && player2.player2Xpos > 0 && p1LW == false && temp2 == false) {
                player2.player2Xpos -= player2.player2Xspeed; // x move left if  not outside canvas
            }
        } //end of player2Move

        function playerGravity() {
            if (gravity > -60 && player.playerYpos < groundYpos - player.PLAYER_SIZE) {
                player.playerYpos += gravity / 5;
                gravity += 2;
            }
        } //end of gravity

        function player2Gravity() {
            if (gravity2 > -60 && player2.player2Ypos < groundYpos - player2.PLAYER2_SIZE) {
                player2.player2Ypos += gravity2 / 5;
                gravity2 += 2;
            }
        } //end of gravity2

        function playerJump() {
            if (wKeyPressed && jumping == false) {
                jumping = true;
                gravity = jumpForce; //jump speed
                player.playerYpos += gravity / 9;
                if (stacking == true) {
                    gravity2 = gravity;
                }
            }
            if (player.playerYpos + player.PLAYER_SIZE >= groundYpos && stacking == false) { //cannot jump more if player xpos is greater than the ground line
                player.playerYSpeed = 0;
                player.playerYpos = groundYpos - player.PLAYER_SIZE; //to stop player sinking through the ground
                jumping = false;
                gravity = 0;
            }

        } //end of playerJump

        function player2Jump() {
            if (upKeyPressed && jumping2 == false) {
                jumping2 = true;
                gravity2 = jumpForce; //jump force speed    
                player2.player2Ypos += gravity2 / 9;
                if (stacking2 == true) {
                    gravity = gravity2;
                }
            }
            if (player2.player2Ypos + player2.PLAYER2_SIZE >= groundYpos && stacking2 == false) { //cannot jump more if player xpos is greater than the horizon line
                player2.player2YSpeed = 0;
                player2.player2Ypos = groundYpos - player2.PLAYER2_SIZE; //to stop player sinking through horizonYpos
                jumping2 = false;
                gravity2 = 0;
            }
        } //end of player2Jump

        function scoring() {
            //goals coordiantes
            let goalLeft = canvas.width / (80 * 10);
            let goalRight = canvas.width / 7.54;
            let goal2Left = canvas.width / 1.156;
            let goal2Right = canvas.width / 1;
            let goalTop = canvas.height / 1.65;
            let goalBot = canvas.height / 1.159274194;

            balls.forEach(Element => {
                if (Element.x > goal2Left && Element.y <= goalTop && Element.ballYspeed > 0 && Element.y >= goalTop - Element.radius) { //top bounce of goal right
                    Element.ballYspeed *= -1;
                    Element.ballYspeed += 1;
                } else if (Element.x < goalRight && Element.y <= goalTop && Element.ballYspeed > 0 && Element.y >= goalTop - Element.radius) { //top bounce of goal right
                    Element.ballYspeed *= -1;
                    Element.ballYspeed += 1;
                }

                if (Element.x > goal2Left && Element.y >= goalTop && Element.ballYspeed < 0 && Element.y <= goalTop + Element.radius) { //underside bounce of goal right
                    Element.ballYspeed *= -1;
                } else if (Element.x < goalRight && Element.y >= goalTop && Element.ballYspeed < 0 && Element.y <= goalTop + Element.radius) { //underside bounce of goal right
                    Element.ballYspeed *= -1;
                }

                if (Element.x < goalRight && Element.y > goalTop && Element.y < goalBot) { //goal left
                    if (goalScored2 == false && gameFinished == false) {
                        score2++;
                        goalScored2 = true;
                    }
                    if (gamemodesCount == 0) {
                        startRestartCount = true;
                    }
                }
                if (Element.x > goal2Left && Element.y > goalTop && Element.y < goalBot) { //goal right
                    if (goalScored == false && gameFinished == false) {
                        score1++;
                        goalScored = true;
                    }
                    if (gamemodesCount == 0) {
                        startRestartCount = true;
                    }
                }
            });
            if (startRestartCount == true) {
                resetCount--;
            }
            if (resetCount < 50 && gamemodesCount == 0) {
                if (score1 < 7) {
                    if (score2 < 7) {
                        drawText(canvas.width / 2, canvas.height / 5, score1 + " - " + score2, "30px Arial", "rgb(0,0,0,1)", "center");
                        drawText(canvas.width / 2, canvas.height / 3.5, "Goal!", "30px Arial", "rgb(0,0,0,1)", "center");
                    }
                }
            }
            if (resetCount <= 0 && gamemodesCount == 0) {
                if (score1 < 7) {
                    if (score2 < 7) {
                        startRestartCount = false;
                        resetGame();
                        goalScored = false;
                        goalScored2 = false;
                    }
                }
            }
        } //end of scoring

        function resetGame() { //resets game after goal has been scored
            balls.forEach(Element => { //balls
                Element.x = canvas.width / 2;
                Element.y = canvas.height / 2;
                Element.ballXspeed = Math.floor(Math.random() * (3 - -1.5)) - 1.5;
                Element.ballYspeed = 0;
            });

            resetCount = 50;
            startPos1();
            startPos2();
            if (singlePlayer == true && twoPlayer == false) {
                startPos3();
            }
            count = 160;
            startGameTimer();
        } //end of resetGame

        function gameEnd() {
            if (gamemodesCount == 0 && score1 == 7) { //first to 7 wins
                drawText(canvas.width / 2, canvas.height / 3.5, "Player1 Won!", "30px Arial", "rgb(0,0,0,1)", "center");
                endGameCount--;
                gameOver = true;
            }
            if (gamemodesCount == 0 && score2 == 7) {
                drawText(canvas.width / 2, canvas.height / 3.5, "Player2 Won!", "30px Arial", "rgb(0,0,0,1)", "center");
                endGameCount--;
                gameOver = true;
            }
            if (gamemodesCount == 1) { //golden goal
                if (score1 == 1) {
                    drawText(canvas.width / 2, canvas.height / 3.5, "Player1 Won!", "30px Arial", "rgb(0,0,0,1)", "center");
                    endGameCount--;
                }
                if (score2 == 1) {
                    drawText(canvas.width / 2, canvas.height / 3.5, "Player2 Won!", "30px Arial", "rgb(0,0,0,1)", "center");
                    endGameCount--;
                }
            }
            if (endGameCount <= 0) {
                gameFinished = true;
            }
            if (gameFinished == true) { //ends game variables
                score1 = 0;
                score2 = 0;
                singlePlayer = false;
                twoPlayer = false;
                gameStart = false;
                singlePlayerSelect = false;
                twoPlayerSelect = false;
                startGame = false;
                instructionsSelect = false;
                mainMenu = true;
                gameFinished = true;
                startingPos = true;
                startingPos2 = true;
                startingPos3 = true;
                startOfGame = true;
                goalScored = false;
                goalScored2 = false;
                startRestartCount = false;
                runOnce = true;
                reset = false;
                gameOver = false;
                resetCount = 50;
                endGameCount = 110;
                if (gameVariantsCount == 1) {
                    balls.pop();
                }
                gamemodesCount = 0;
                gameVariantsCount = 0;
                difficultyCount = 0;

                balls.forEach(Element => {
                    Element.x = canvas.width / 2;
                    Element.y = canvas.height / 2;
                    Element.ballXspeed = Math.floor(Math.random() * (3 - -1.5)) - 1.5;
                    Element.ballYspeed = 0;
                });
            }
        } //end of gameEnd

        function startGameTimer() {
            if (count >= 0) {
                count -= 1;
                if (count <= 160 && count >= 110) {
                    drawImage(imageAssets.background, 0, 0, canvas.width, canvas.height); //bg
                    drawText(canvas.width / 2, canvas.height / 3, "3", "30px Arial", "rgb(0,0,0,1)", "center");
                    drawText(canvas.width / 2, canvas.height / 5, score1 + " - " + score2, "30px Arial", "rgb(0,0,0,1)", "center");
                    if (startOfGame == true && gamemodesCount == 0) {
                        drawText(canvas.width / 2, canvas.height - 30, "First to seven wins!", "30px Arial", "rgb(0,0,0,1)", "center");
                        if (gameVariantsCount == 1) {
                            drawText(canvas.width / 2, canvas.height - 200, "Balls do not effect each other!", "25px Arial", "rgb(0,0,0,1)", "center");
                        }
                    }
                    if (gamemodesCount == 1) {
                        drawText(canvas.width / 2, canvas.height - 30, "First to score wins!", "30px Arial", "rgb(0,0,0,1)", "center");
                        if (gameVariantsCount == 1) {
                            drawText(canvas.width / 2, canvas.height - 200, "Balls do not effect each other!", "25px Arial", "rgb(0,0,0,1)", "center");
                        }
                    }
                }
                if (count <= 110 && count >= 60) {
                    drawImage(imageAssets.background, 0, 0, canvas.width, canvas.height); //bg
                    drawText(canvas.width / 2, canvas.height / 3, "2", "30px Arial", "rgb(0,0,0,1)", "center");
                    drawText(canvas.width / 2, canvas.height / 5, score1 + " - " + score2, "30px Arial", "rgb(0,0,0,1)", "center");
                    if (startOfGame == true && gamemodesCount == 0) {
                        drawText(canvas.width / 2, canvas.height - 30, "First to seven wins!", "30px Arial", "rgb(0,0,0,1)", "center");
                        if (gameVariantsCount == 1) {
                            drawText(canvas.width / 2, canvas.height - 200, "Balls do not effect each other!", "25px Arial", "rgb(0,0,0,1)", "center");
                        }
                    }
                    if (gamemodesCount == 1) {
                        drawText(canvas.width / 2, canvas.height - 30, "First to score wins!", "30px Arial", "rgb(0,0,0,1)", "center");
                        if (gameVariantsCount == 1) {
                            drawText(canvas.width / 2, canvas.height - 200, "Balls do not effect each other!", "25px Arial", "rgb(0,0,0,1)", "center");
                        }
                    }
                }
                if (count <= 60 && count >= 10) {
                    drawImage(imageAssets.background, 0, 0, canvas.width, canvas.height); //bg
                    drawText(canvas.width / 2, canvas.height / 3, "1", "30px Arial", "rgb(0,0,0,1)", "center");
                    drawText(canvas.width / 2, canvas.height / 5, score1 + " - " + score2, "30px Arial", "rgb(0,0,0,1)", "center");
                    if (startOfGame == true && gamemodesCount == 0) {
                        drawText(canvas.width / 2, canvas.height - 30, "First to seven wins!", "30px Arial", "rgb(0,0,0,1)", "center");
                        if (gameVariantsCount == 1) {
                            drawText(canvas.width / 2, canvas.height - 200, "Balls do not effect each other!", "25px Arial", "rgb(0,0,0,1)", "center");
                        }
                    }
                    if (gamemodesCount == 1) {
                        drawText(canvas.width / 2, canvas.height - 30, "First to score wins!", "30px Arial", "rgb(0,0,0,1)", "center");
                        if (gameVariantsCount == 1) {
                            drawText(canvas.width / 2, canvas.height - 200, "Balls do not effect each other!", "25px Arial", "rgb(0,0,0,1)", "center");
                        }
                    }
                }
                if (count <= 10 && count >= 0) {
                    drawImage(imageAssets.background, 0, 0, canvas.width, canvas.height); //bg
                    startOfGame = false;
                }
            }
        } //end of startGameTimer

        function keyPressed(evt) {
            if (evt.keyCode == LEFT_KEY) {
                leftKeyPressed = true;
            }
            if (evt.keyCode == RIGHT_KEY) {
                rightKeyPressed = true;
            }
            if (evt.keyCode == UP_KEY) {
                upKeyPressed = true;
            }
            if (evt.keyCode == DOWN_KEY) {
                downKeyPressed = true;
            } //player 2

            if (evt.keyCode == A_KEY) {
                aKeyPressed = true;
            }
            if (evt.keyCode == D_KEY) {
                dKeyPressed = true;
            }
            if (evt.keyCode == W_KEY) {
                wKeyPressed = true;
            }
            if (evt.keyCode == S_KEY) {
                sKeyPressed = true;
            } //player 1
        } //end of keyPressed

        function keyReleased(evt) {
            if (evt.keyCode == LEFT_KEY) {
                leftKeyPressed = false;
                stopped = false;
                temp1 = false;
                temp2 = false;
                pushingLeft = false;
                pushingRight = false;
            }
            if (evt.keyCode == RIGHT_KEY) {
                rightKeyPressed = false;
                stopped = false;
                temp1 = false;
                temp2 = false;
                pushingLeft = false;
                pushingRight = false;
            }
            if (evt.keyCode == UP_KEY) {
                upKeyPressed = false;
            }
            if (evt.keyCode == DOWN_KEY) {
                downKeyPressed = false;
            } //player 2

            if (evt.keyCode == A_KEY) {
                aKeyPressed = false;
                stopped = false;
                temp1 = false;
                temp2 = false;
                pushing2Left = false;
                pushing2Right = false;
            }
            if (evt.keyCode == D_KEY) {
                dKeyPressed = false;
                stopped = false;
                temp1 = false;
                temp2 = false;
                pushing2Left = false;
                pushing2Right = false;
            }
            if (evt.keyCode == W_KEY) {
                wKeyPressed = false;
            }
            if (evt.keyCode == S_KEY) {
                sKeyPressed = false;
            } //player 1
        } //end of keyReleased

        function mouseAction(evt) { //mouse code
            var rect = canvas.getBoundingClientRect();
            var root = document.documentElement;

            mouseX = evt.clientX - rect.left - root.scrollLeft;
            mouseY = evt.clientY - rect.top - root.scrollTop;

            return {
                x: mouseX,
                y: mouseY
            }
        } //end of mouseAction

        document.body.onmousedown = function() {
            ++mouseDown;
        }
        document.body.onmouseup = function() {
            --mouseDown;
        }

        function colorRect(x, y, w, h, c) {
            ctx.fillStyle = c;
            ctx.fillRect(x, y, w, h);
        } //end of colorRect

        function drawText(x, y, t, f, c, d) {
            ctx.fillStyle = c;
            ctx.textAlign = d;
            ctx.font = f;
            ctx.fillText(t, x, y);
        } //end of drawText

        function drawPlayer(src, x, y, w, h) {
            ctx.drawImage(imgs.player1, player.playerXpos, player.playerYpos, player.PLAYER_SIZE, player.PLAYER_SIZE);
        } //end of drawPlayer

        function drawPlayer2(src, x, y, w, h) {
            ctx.drawImage(imgs.player2, player2.player2Xpos, player2.player2Ypos, player2.PLAYER2_SIZE, player2.PLAYER2_SIZE);
        } //end of drawPlayer2

        function drawBot(src, x, y, w, h) {
            ctx.drawImage(imgs.bot, bot.botXpos, bot.botYpos, bot.BOT_SIZE, bot.BOT_SIZE);
        } //end of drawBot

        function drawGround(x, y, w, h, c) {
            ctx.fillStyle = '#48892e';
            ctx.fillRect(groundXpos, groundYpos, groundLength, groundLength);
        } //end of drawGround

        function drawBall(x, y, r, c) {
            ctx.beginPath();
            ctx.arc(x, y, r, 0, 2 * Math.PI);
            ctx.fillStyle = c;
            ctx.fill();
            ctx.closePath();
        } //end of drawBall

        function drawImage(src, x, y, w, h) {
            ctx.drawImage(src, x, y, w, h);
        } //end of drawImage

    </script>
</body>
