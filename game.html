<!doctype html>

<head>
    <title>Big Head Soccer</title>
</head>

<body>
    <style>
        canvas {
            padding-left: 0;
            padding-right: 0;
            margin-left: auto;
            margin-right: auto;
            margin-top: 15vh;
            display: block;
        }

    </style>

    <canvas id="gameCanvas" width="800" height="575"></canvas>
    <script>
        var canvas, ctx;

        var ball;

        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');

            imageAssets = loadImages();

            setInterval(mainloop, 1000 / 50);

            ball = {
                x: canvas.width / 2,
                y: canvas.height / 2,
                radius: 15,
                status: 0
            }; //ball size and starting position

            document.addEventListener('keydown', keyPressed);
            document.addEventListener('keyup', keyReleased);

            document.addEventListener('mousemove', function(evt) { //mouse code
                var mousePos = mouseAction(evt);
                mouseX = mousePos.x;
                mouseY = mousePos.y;
                //                console.log(mouseX);
                //                console.log(mouseY);

                //                                var Rectangle;
            });
        }


        //player 1
        player = {
            playerXpos: 0,
            playerYpos: 0,
            PLAYER_SIZE: 40,
            playerXspeed: 3.5,
            playerYspeed: 5,
        }

        //        var top = player.playerYpos;
        //        var bot = player.playerYpos + player.PLAYER_SIZE;
        //        var left = player.playerXpos;
        //        var right = player.playerXpos + player.PLAYER_SIZE;

        // player 2
        player2 = {
            player2Xpos: 0,
            player2Ypos: 0,
            PLAYER2_SIZE: 40,
            player2Xspeed: 3.5,
            player2Yspeed: 5,
        }

        //        var top2 = player2.player2Ypos;
        //        var bot2 = player2.player2Ypos + player2.PLAYER2_SIZE;
        //        var left2 = player2.player2Xpos;
        //        var right2 = player2.player2Xpos + player2.PLAYER2_SIZE;

        //physics
        var gravity = 0.1;
        var gravity2 = 0.1;
        var ballGravity = 0.15;
        var bounce = 0.6;
        var friction = 0.1;
        var jumpForce = -30;
        var jumping = false;
        var jumping2 = false;
        var kickspeed = 4.5;
        var stacking = false;
        var stacking2 = false;
        var pushing = false;
        var pushing2 = false;

        var playerCollision = false;
        var player2Collision = false;

        //ground variables
        var groundYpos = 0;
        var groundXpos = 0;
        var groundWidth = 0;
        var groundLength = 0;

        //ball speeds
        var ballXspeed = 3.5;
        var ballYspeed = 0;
        var minBallXspeed = 1.5;
        var maxBallXspeed = 3.5;

        //controls for players

        //player 1
        const A_KEY = 65;
        const D_KEY = 68;
        const W_KEY = 87;
        const S_KEY = 83;
        var aKeyPressed = false;
        var dKeyPressed = false;
        var wKeyPressed = false;
        var sKeyPressed = false;

        //player 2
        const LEFT_KEY = 37;
        const RIGHT_KEY = 39;
        const UP_KEY = 38;
        const DOWN_KEY = 40;
        var leftKeyPressed = false;
        var rightKeyPressed = false;
        var upKeyPressed = false;
        var downKeyPressed = false;

        //game variables
        var mouseX, mouseY;
        var mouseDown = 0;
        var startingPos = true;
        var startingPos2 = true;
        var gameStart = false;
        var singlePlayer = false;
        var twoPlayer = false;

        // menu buttons
        var mainMenu = true;
        var singlePlayerSelect = false;
        var twoPlayerSelect = false;
        var instructionsSelect = false;
        //        var nameSelect = [];

        //coordinates

        //button 1-3 x
        var buttonXposLeft = 283.5;
        var buttonXposRight = 508;

        //button 1 y
        var buttonYposTop = 206.6;
        var buttonYposBot = 254;

        //button 2 y
        var button2YposTop = 282.6;
        var button2YposBot = 330;

        //button 3 y
        var button3YposTop = 358.6;
        var button3YposBot = 406;

        //start button
        var startButtonLeft = 307.5;
        var startButtonRight = 465.5;

        var startButtonTop = 405.6;
        var startButtonBot = 445.5;

        function mainloop() {
            if (mainMenu == false) {
                if (gameStart == true) {

                    //                    colorRect(0, 0, canvas.width, canvas.height, 'black'); // bg
                    drawImage(imageAssets.background, 0, 0, canvas.width, canvas.height); //draws the menu screen


                    if (singlePlayer == true) { //run single player
                        gameSetup();
                        singlePlayerRun();
                        return twoPlayerRun;
                    }
                    if (twoPlayer == true) { // run two player
                        gameSetup();
                        twoPlayerRun();
                        singlePlayerRun(); // has to be correct order in order for collisons to work
                    }
                }

            } else {
                drawImage(imageAssets.menuScreen, 0, 0, canvas.width, canvas.height); //draws the menu screen
                menuButtons(); //allows for menu buttons to be interacted with

                if (singlePlayerSelect == true) { //display screen for single play select if it is true inside the menu buttons function
                    drawImage(imageAssets.temporaryStart, 0, 0, canvas.width, canvas.height);
                    if (mouseX >= startButtonLeft && mouseX <= startButtonRight && mouseY >= startButtonTop && mouseY <= startButtonBot) { // coordinates of button
                        hoverStartButton();
                        if (mouseDown) {
                            mainMenu = false;
                            gameStart = true;
                            singlePlayer = true;
                        }
                    }
                }
                if (twoPlayerSelect == true) { //display screen for two player select if it is true inside the menuButtons function
                    drawImage(imageAssets.twoPlayerSelection, 0, 0, canvas.width, canvas.height);
                    if (mouseX >= startButtonLeft && mouseX <= startButtonRight && mouseY >= startButtonTop && mouseY <= startButtonBot) {
                        hoverStartButton();
                        if (mouseDown) {
                            mainMenu = false;
                            gameStart = true;
                            twoPlayer = true;
                        }
                    }
                }
            }
        } //end of mainloop

        function gameSetup() {
            groundLength = canvas.width;
            groundYpos = canvas.height - 75;

            drawGround();
            drawBall();
            ballCollisions();
            ballMove();

        } //end gameSetup

        function singlePlayerRun() { //all functions requried for single player
            if (startingPos == true) { //starting position
                startPos1();
                startingPos = false;
            }

            drawPlayer();
            playerGravity();
            playerMove();
            playerJump();
            //            playerCollisions(); // if this is active then right side of player 2 doesn't work

        } //end of singlePlayerRun

        function twoPlayerRun() { // all functions required for two player 
            if (startingPos2 == true) {
                startPos2();
                startingPos2 = false;
            }

            drawPlayer2();
            player2Gravity();
            player2Move();
            player2Jump();
            playerCollisions();

        } //end of twoPlayerRun

        function menuButtons() {
            if (mouseX >= buttonXposLeft && mouseX <= buttonXposRight && mouseY >= buttonYposTop && mouseY <= buttonYposBot) { // button 1 coordinates
                hoverButton1();
                if (mouseDown && twoPlayerSelect == false && instructionsSelect == false) {
                    singlePlayerSelect = true;
                }
            }
            if (mouseX >= buttonXposLeft && mouseX <= buttonXposRight && mouseY >= button2YposTop && mouseY <= button2YposBot) { // button 2 coordinates
                hoverButton2();
                if (mouseDown && singlePlayerSelect == false && instructionsSelect == false) {
                    twoPlayerSelect = true;
                }
            }
            if (mouseX >= buttonXposLeft && mouseX <= buttonXposRight && mouseY >= button3YposTop && mouseY <= button3YposBot) { // button 3 coordinates
                hoverButton3();
                if (mouseDown & singlePlayerSelect == false && twoPlayerSelect == false) {
                    instructionsSelect = true;
                }
            }
        } //end of menuButtons

        function startPos1() { //starting position for player 1 
            player.playerXpos = canvas.width / 7 - player.PLAYER_SIZE / 2;
            player.playerYpos = canvas.height / 1.225 - player.PLAYER_SIZE / 2;
        } //end of startPos

        function startPos2() { //starting position for player 2
            player2.player2Xpos = canvas.width / 1.2 - player2.PLAYER2_SIZE / 2;
            player2.player2Ypos = canvas.height / 1.225 - player2.PLAYER2_SIZE / 2;
        } //end of startPos2

        function loadImages() {
            imgs = [];
            imgs.background = new Image();
            imgs.background.src = 'img/tempBack.png';
            imgs.menuScreen = new Image();
            imgs.menuScreen.src = 'img/menuScreen.png';
            imgs.twoPlayerSelection = new Image();
            imgs.twoPlayerSelection.src = 'img/2playerMenu.png';
            imgs.instructionsSelection = new Image();
            imgs.instructionsSelection.src = '';
            imgs.temporaryStart = new Image();
            imgs.temporaryStart.src = 'img/start.png';
            return imgs;
        } // end of loadImages

        function ballMove() {
            ball.x += ballXspeed; //x speed
            ball.y += ballYspeed; //y spped
            ballYspeed += ballGravity; //apply gravity to ball y speed

            if (ball.y + ball.radius > groundYpos) { //if the ball is greater than the ground floor
                ball.y = groundYpos - ball.radius; //reposition on the ground
                ballYspeed *= -bounce; //bounce the ball

                if (ballYspeed < 0 && ballYspeed > -2.2) { //do this otherwise, ball never stops bouncing
                    ballYspeed = 0;
                }
                ballFriction(); //apply friction
            }
            if (ball.x > canvas.width - ball.radius && ballXspeed > 0) { //right edge bounce
                ballXspeed *= -1;
            }
            if (ball.x < 0 + ball.radius && ballXspeed < 0) { //left edge bounce
                ballXspeed *= -1;
            }
            //            console.log(ballXspeed);
            //            console.log(ballYspeed);
        } //end of ballMove

        function ballFriction() {
            if (Math.abs(ballXspeed) > minBallXspeed) { //apply friction if ball speed is bigger than this
                if (ballXspeed > 0) {
                    ballXspeed = ballXspeed - friction;
                } else if (ballXspeed < 0) {
                    ballXspeed = ballXspeed + friction;
                }
            } else if (Math.abs(ballXspeed) > minBallXspeed / 2) { //stages of friction
                if (ballXspeed > 0) {
                    ballXspeed = ballXspeed - friction / 4;
                } else if (ballXspeed < 0) {
                    ballXspeed = ballXspeed + friction / 4;
                }
            } else if (Math.abs(ballXspeed) > minBallXspeed / 4) {
                if (ballXspeed > 0) {
                    ballXspeed = ballXspeed - friction / 8;
                } else if (ballXspeed < 0) {
                    ballXspeed = ballXspeed + friction / 8;
                }
            } else if (Math.abs(ballXspeed) > minBallXspeed / 8) {
                if (ballXspeed > 0) {
                    ballXspeed = ballXspeed - friction / 16;
                } else if (ballXspeed < 0) {
                    ballXspeed = ballXspeed + friction / 16;
                }
            }
        } //end of ballFriction

        function ballCollisions() {
            if (ball.x - ball.radius <= player.playerXpos + player.PLAYER_SIZE && ball.x + ball.radius >= player.playerXpos && ball.y <= player.playerYpos + player.PLAYER_SIZE && ball.y + ball.radius >= player.playerYpos) { //player1 hitbox with ball

                if (playerCollision == false) {

                    if (dKeyPressed == false && aKeyPressed == false) {
                        ballXspeed *= -1;
                    } else {
                        if (ball.x < player.playerXpos + player.PLAYER_SIZE / 2) {
                            ballXspeed = -kickspeed; //fix this *********
                        }
                        if (ball.x >= player.playerXpos + player.PLAYER_SIZE / 2) {
                            ballXspeed = kickspeed;
                        } //if ball inside player it will go outwards in the right direction
                    }
                }
                ballYspeed = gravity / 5 - 2; //how high the ball goes when player hits it in the y direction
                playerCollision = true;
                //                player2Collision = false;
            } else {
                playerCollision = false;
            } //end of player 1 collisions with ball

            if (ball.x - ball.radius <= player2.player2Xpos + player2.PLAYER2_SIZE && ball.x + ball.radius >= player2.player2Xpos && ball.y <= player2.player2Ypos + player2.PLAYER2_SIZE && ball.y + ball.radius >= player2.player2Ypos) { //player 2 hitbox when it touches ball

                if (player2Collision == false) {

                    if (rightKeyPressed == false && leftKeyPressed == false) {
                        ballXspeed *= -1;
                    } else {
                        if (ball.x < player2.player2Xpos + player2.PLAYER2_SIZE / 2) {
                            ballXspeed = -kickspeed;
                        }
                        if (ball.x >= player2.player2Xpos + player2.PLAYER2_SIZE / 2) {
                            ballXspeed = kickspeed;
                        } //if ball inside player it will go outwards in the right direction
                    }
                    //                }
                }
                ballYspeed = gravity2 / 5 - 1; //how high the ball goes when player 2 hits it in the y direction
                player2Collision = true;
            } else {
                player2Collision = false;
            } //end of player 2 collisions with ball
            //            console.log(playerCollision, player2Collision);
        } //end of ball Collisions

        function playerCollisions() {
            if (player.playerXpos + player.PLAYER_SIZE >= player2.player2Xpos && player.playerXpos < player2.player2Xpos + player2.PLAYER2_SIZE && player.playerYpos + player.PLAYER_SIZE >= player2.player2Ypos) { //player 1 hitbox
                playerCollision = true;
                if (dKeyPressed == true && player2.player2Xpos < canvas.width - player2.PLAYER2_SIZE) { //if not otuside canvas move other player
                    pushing = true;
                } else {
                    pushing = false;
                }

                if (pushing == true && pushing2 == false && stacking == false && stacking2 == false && leftKeyPressed == false) {
                    player2.player2Xpos += player.playerXspeed;
                }

                if (player.playerYpos + player.PLAYER_SIZE > player2.player2Ypos && player.playerYpos + player.PLAYER_SIZE < player2.player2Ypos + player2.PLAYER2_SIZE / 2) { //stacking
                    player.playerYpos = player2.player2Ypos - player2.PLAYER2_SIZE;
                    gravity = gravity2;
                    stacking = true;
                } else {
                    stacking = false;
                }
            } else {
                stacking = false;

            } //player 1 collisions

            if (player.playerXpos + player.PLAYER_SIZE >= player2.player2Xpos && player.playerXpos < player2.player2Xpos + player2.PLAYER2_SIZE && player2.player2Ypos + player2.PLAYER2_SIZE >= player.playerYpos) { // player 2 hitbox
                player2Collision = true;

                if (rightKeyPressed && player.playerXpos < canvas.width - player.PLAYER_SIZE) { // if not outside push other play
                    player.playerXpos += player2.player2Xspeed;
                    pushing2 = true
                } else {
                    pushing2 = false;
                }

                if (pushing2 == true && dKeyPressed == false) {
                    player.playerXpos += player2.player2Xspeed;
                }

                if (player2.player2Ypos + player2.PLAYER2_SIZE > player.playerYpos && player2.playerYpos + player2.PLAYER2_SIZE < player.playerYpos + player.PLAYER_SIZE / 2) { // stacking
                    player2.player2Ypos = player.playerYpos - player.PLAYER_SIZE;
                    gravity2 = gravity;
                    stacking2 = true;
                } else {
                    stacking2 = false;
                }
            }else{
                stacking2 = false;
            } //player 2 collisions

            //        if(pushing == true && pushing2 == true){
            //            player.playerXspeed = 0;
            //            player2.player2Xspeed = 0;
            //        }
            console.log(pushing);
        } //end of playerCollisions

        function playerMove() {
            if (dKeyPressed && player.playerXpos < canvas.width - player.PLAYER_SIZE) {
                player.playerXpos += player.playerXspeed; // x move right if not outside canvas
            }
            if (aKeyPressed && player.playerXpos > 0) {
                player.playerXpos -= player.playerXspeed; // x move left if not outside canvas
            }
        } //end of playerMove

        function player2Move() {
            if (rightKeyPressed && player2.player2Xpos < canvas.width - player2.PLAYER2_SIZE) {
                player2.player2Xpos += player2.player2Xspeed; // x move right if not outside canvas
            }
            if (leftKeyPressed && player2.player2Xpos > 0) {
                player2.player2Xpos -= player2.player2Xspeed; // x move left if  not outside canvas
            }
        } //end of player2Move

        function playerGravity() {
            if (gravity > -60 && player.playerYpos < groundYpos - player.PLAYER_SIZE) {
                player.playerYpos += gravity / 5;
                gravity += 2;
            }
        } //end of gravity

        function player2Gravity() {
            if (gravity2 > -60 && player2.player2Ypos < groundYpos - player2.PLAYER2_SIZE) {
                player2.player2Ypos += gravity2 / 5;
                gravity2 += 2;
            }
        } //end of gravity2

        function playerJump() {
            if (wKeyPressed && jumping == false) {
                jumping = true;
                gravity = jumpForce; //jump speed
                                player.playerYpos += gravity/10;
                if (stacking == true) {
                    gravity2 = gravity;
                }
            }
            if (player.playerYpos + player.PLAYER_SIZE >= groundYpos && stacking == false) { //cannot jump more if player xpos is greater than the ground line
                player.playerYSpeed = 0;
                player.playerYpos = groundYpos - player.PLAYER_SIZE; //to stop player sinking through the ground
                jumping = false;
                gravity = 0;
            }

        } //end of playerJump

        function player2Jump() {
            if (upKeyPressed && jumping2 == false) {
                jumping2 = true;
                gravity2 = jumpForce; //jump force speed
                                player2.player2Ypos += gravity2/10;
                if(stacking2 == true){
                    gravity = gravity2;
                }
            }
            if (player2.player2Ypos + player2.PLAYER2_SIZE >= groundYpos && stacking == false) { //cannot jump more if player xpos is greater than the horizon line
                player2.player2YSpeed = 0;
                player2.player2Ypos = groundYpos - player2.PLAYER2_SIZE; //to stop player sinking through horizonYpos
                jumping2 = false;
                gravity2 = 0;
            }
        } //end of player2Jump

        function keyPressed(evt) {
            if (evt.keyCode == LEFT_KEY) {
                leftKeyPressed = true;
            }
            if (evt.keyCode == RIGHT_KEY) {
                rightKeyPressed = true;
            }
            if (evt.keyCode == UP_KEY) {
                upKeyPressed = true;
            }
            if (evt.keyCode == DOWN_KEY) {
                downKeyPressed = true;
            } //player 2

            if (evt.keyCode == A_KEY) {
                aKeyPressed = true;
            }
            if (evt.keyCode == D_KEY) {
                dKeyPressed = true;
            }
            if (evt.keyCode == W_KEY) {
                wKeyPressed = true;
            }
            if (evt.keyCode == S_KEY) {
                sKeyPressed = true;
            } //player 1
        } //end of keyPressed

        function keyReleased(evt) {
            if (evt.keyCode == LEFT_KEY) {
                leftKeyPressed = false;
            }
            if (evt.keyCode == RIGHT_KEY) {
                rightKeyPressed = false;
            }
            if (evt.keyCode == UP_KEY) {
                upKeyPressed = false;
            }
            if (evt.keyCode == DOWN_KEY) {
                downKeyPressed = false;
            } //player 2

            if (evt.keyCode == A_KEY) {
                aKeyPressed = false;
            }
            if (evt.keyCode == D_KEY) {
                dKeyPressed = false;
            }
            if (evt.keyCode == W_KEY) {
                wKeyPressed = false;
            }
            if (evt.keyCode == S_KEY) {
                sKeyPressed = false;
            } //player 1
        } //end of keyReleased

        //        function name(){
        //            if(gameStart = false && twoPlayerSelect == true){
        //                
        //            }
        //        }

        function mouseAction(evt) { //mouse code
            var rect = canvas.getBoundingClientRect();
            var root = document.documentElement;

            mouseX = evt.clientX - rect.left - root.scrollLeft;
            mouseY = evt.clientY - rect.top - root.scrollTop;

            return {
                x: mouseX,
                y: mouseY
            }
        } //end of mouseAction

        document.body.onmousedown = function() {
            ++mouseDown;
        }
        document.body.onmouseup = function() {
            --mouseDown;
        }

        function colorRect(x, y, w, h, c) {
            ctx.fillStyle = c;
            ctx.fillRect(x, y, w, h);
        } //end of colorRect

        function drawPlayer(x, y, w, h, c) {
            ctx.fillStyle = 'red';
            ctx.fillRect(player.playerXpos, player.playerYpos, player.PLAYER_SIZE, player.PLAYER_SIZE);
        } //end of drawPlayer

        function drawPlayer2(x, y, w, h, c) {
            ctx.fillStyle = 'blue';
            ctx.fillRect(player2.player2Xpos, player2.player2Ypos, player2.PLAYER2_SIZE, player2.PLAYER2_SIZE);
        } //end of drawPlayer2

        function drawGround(x, y, w, h, c) {
            ctx.fillStyle = 'green';
            ctx.fillRect(groundXpos, groundYpos, groundLength, groundLength);
        } //end of drawGround

        function drawBall(x, y, w, h, c) {
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, 2 * Math.PI);
            ctx.fillStyle = 'white';
            ctx.fill();
            ctx.closePath();
        } //end of drawBall

        function drawImage(src, x, y, w, h) {
            ctx.drawImage(src, x, y, w, h);
        } //end of drawImage

        function hoverButton1(x, y, w, h, c) {
            colorRect(buttonXposLeft, buttonYposTop, (buttonXposRight - buttonXposLeft), (buttonYposBot - buttonYposTop), 'rgb(0,0,0,0.2)');
        } //end of hoverButton1

        function hoverButton2(x, y, w, h, c) {
            colorRect(buttonXposLeft, button2YposTop, (buttonXposRight - buttonXposLeft), (button2YposBot - button2YposTop), 'rgb(0,0,0,0.2)');
        } //end of hoverButtons2

        function hoverButton3(x, y, w, h, c) {
            colorRect(buttonXposLeft, button3YposTop, (buttonXposRight - buttonXposLeft), (button3YposBot - button3YposTop), 'rgb(0,0,0,0.2)');
        } //end of hoverButton3

        function hoverStartButton(x, y, w, h, c) {
            colorRect(startButtonLeft, startButtonTop, (startButtonRight - startButtonLeft), (startButtonBot - startButtonTop), 'rgb(0,0,0,0.2)');
        } //end of hoverStartButton

    </script>
</body>
